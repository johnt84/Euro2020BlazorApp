@page "/fixturesandresults"

@using FootballBlazorApp.Models;
@using FootballBlazorApp.Data;
@using FootballBlazorApp.Components;
@using Models.Enums;
@inject IFootballDataService FootballDataService;

<h1 style="padding-bottom: 10px;">Fixtures & Results</h1>

@if (fixturesAndResultsByDays == null && !isInvalidFixturesAndResults)
{
    <p><em>Loading...</em></p>
}
else if (isInvalidFixturesAndResults)
{
    <ErrorMessage Error="@ErrorMessage"></ErrorMessage>
}
else if (!fixturesAndResultsByDays.Any())
{
    <ErrorMessage Error="No fixtures could be found"></ErrorMessage>
}
else
{
    @foreach (var fixtureandResultByDay in fixturesAndResultsByDaysFilteredByMatchday)
    {
        <FixturesAndResultsByDay ComponentSource="Enums.ComponentSource.FixturesAndResults" FixturesAndResultsByDayModel="fixtureandResultByDay"></FixturesAndResultsByDay>
    }
}

@code {
    private List<Models.FixturesAndResultsByDay> fixturesAndResultsByDays = null;
    private List<Models.FixturesAndResultsByDay> fixturesAndResultsByDaysFilteredByMatchday = null;

    private bool isInvalidFixturesAndResults = false;

    private string ErrorMessage { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            fixturesAndResultsByDays = await FootballDataService.GetFixturesAndResultsByDays();

            isInvalidFixturesAndResults = false;
        }
        catch (Exception ex) when (ex.Message.Contains(Constants.TOO_MANY_REQUESTS_ERROR_CODE.ToString()))
        {
            isInvalidFixturesAndResults = true;
            ErrorMessage = Constants.TOO_MANY_REQUESTS_ERROR_MESSAGE;
        }
        catch (Exception)
        {
            isInvalidFixturesAndResults = true;
            ErrorMessage = $"Could not retrieve any fixtures & results";
        }
    }
}
